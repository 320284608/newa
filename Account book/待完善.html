<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人生活记账系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.3s;
        }

        .fade-enter,
        .fade-leave-to {
            opacity: 0;
        }

        .slide-up-enter-active,
        .slide-up-leave-active {
            transition: all 0.3s ease;
        }

        .slide-up-enter,
        .slide-up-leave-to {
            transform: translateY(20px);
            opacity: 0;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .type-toggle {
            display: flex;
            border-radius: 0.375rem;
            overflow: hidden;
            border: 1px solid #d1d5db;
        }

        .type-toggle-btn {
            flex: 1;
            padding: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .type-toggle-btn.active {
            background-color: #4f46e5;
            color: white;
        }

        .type-toggle-btn:not(.active):hover {
            background-color: #f3f4f6;
        }
    </style>
</head>

<body class="bg-gray-100 font-sans">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 头部 -->
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-indigo-700">
                <i class="fas fa-wallet mr-2"></i>个人生活记账
            </h1>
            <div class="flex space-x-4">
                <button id="settingsBtn" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition">
                    <i class="fas fa-cog mr-1"></i>设置
                </button>
                <button id="exportBtn" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition">
                    <i class="fas fa-file-export mr-1"></i>导出数据
                </button>
                <button id="syncBtn" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition">
                    <i class="fas fa-sync-alt mr-1"></i>同步数据
                </button>
            </div>
        </header>

        <!-- 主要内容区 -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- 左侧 - 添加账单 -->
            <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">
                    <i class="fas fa-plus-circle mr-2 text-indigo-500"></i>添加账单
                </h2>

                <form id="expenseForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">类型</label>
                        <div class="type-toggle">
                            <div id="expenseType" class="type-toggle-btn active">支出</div>
                            <div id="incomeType" class="type-toggle-btn">收入</div>
                        </div>
                    </div>

                    <div>
                        <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">金额</label>
                        <div class="relative rounded-md shadow-sm">
                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-500 sm:text-sm">¥</span>
                            </span>
                            <input type="number" id="amount" name="amount" class="focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-7 pr-12 py-2 sm:text-sm border-gray-300 rounded-md" placeholder="0.00" step="0.01" required>
                        </div>
                    </div>

                    <div>
                        <label for="category" class="block text-sm font-medium text-gray-700 mb-1">分类</label>
                        <select id="category" name="category" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <option value="餐饮">餐饮</option>
                            <option value="交通">交通</option>
                            <option value="购物">购物</option>
                            <option value="娱乐">娱乐</option>
                            <option value="住房">住房</option>
                            <option value="医疗">医疗</option>
                            <option value="教育">教育</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>

                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700 mb-1">日期</label>
                        <input type="date" id="date" name="date" class="focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-3 pr-10 py-2 sm:text-sm border-gray-300 rounded-md" required>
                    </div>

                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700 mb-1">备注</label>
                        <textarea id="description" name="description" rows="2" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border border-gray-300 rounded-md" placeholder="可选"></textarea>
                    </div>

                    <div class="flex space-x-3">
                        <button type="submit" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-md transition">
                            <i class="fas fa-save mr-1"></i>保存
                        </button>
                        <button type="reset" class="flex-1 bg-gray-200 hover:bg-gray-300 py-2 px-4 rounded-md transition">
                            <i class="fas fa-undo mr-1"></i>重置
                        </button>
                    </div>
                </form>
            </div>

            <!-- 右侧 - 近期账单 -->
            <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">
                        <i class="fas fa-history mr-2 text-indigo-500"></i>近期账单
                    </h2>
                    <div class="flex items-center space-x-2">
                        <select id="filterType" class="text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="all">所有类型</option>
                            <option value="expense">支出</option>
                            <option value="income">收入</option>
                        </select>
                        <select id="filterCategory" class="text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">所有分类</option>
                            <option value="餐饮">餐饮</option>
                            <option value="交通">交通</option>
                            <option value="购物">购物</option>
                            <option value="娱乐">娱乐</option>
                            <option value="住房">住房</option>
                            <option value="医疗">医疗</option>
                            <option value="教育">教育</option>
                            <option value="其他">其他</option>
                        </select>
                        <input type="date" id="filterDate" class="text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>

                <div class="overflow-y-auto max-h-96 custom-scrollbar">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">类型</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">日期</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分类</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">金额</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">备注</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                            </tr>
                        </thead>
                        <tbody id="expenseList" class="bg-white divide-y divide-gray-200">
                            <!-- 账单列表将通过JavaScript动态生成 -->
                        </tbody>
                    </table>
                </div>

                <div class="mt-4 flex justify-between items-center">
                    <div class="text-sm text-gray-500">
                        共 <span id="totalCount" class="font-semibold">0</span> 条记录
                    </div>
                    <div class="flex space-x-4">
                        <div class="text-lg font-semibold text-red-500">
                            支出: ¥<span id="totalExpense">0.00</span>
                        </div>
                        <div class="text-lg font-semibold text-green-500">
                            收入: ¥<span id="totalIncome">0.00</span>
                        </div>
                        <div class="text-lg font-semibold">
                            结余: ¥<span id="totalBalance">0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 统计卡片 -->
        <div class="mt-6 grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="bg-white p-4 rounded-lg shadow">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-indigo-100 text-indigo-600">
                        <i class="fas fa-calendar-day text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">今日支出</p>
                        <p class="text-xl font-semibold text-red-500">¥<span id="todayExpense">0.00</span></p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-100 text-green-600">
                        <i class="fas fa-calendar-week text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">本周支出</p>
                        <p class="text-xl font-semibold text-red-500">¥<span id="weekExpense">0.00</span></p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                        <i class="fas fa-calendar-alt text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">本月支出</p>
                        <p class="text-xl font-semibold text-red-500">¥<span id="monthExpense">0.00</span></p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                        <i class="fas fa-piggy-bank text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">本月结余</p>
                        <p class="text-xl font-semibold text-green-500">¥<span id="monthBalance">0.00</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 设置模态框 -->
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-screen overflow-y-auto">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-xl font-semibold text-gray-800">
                    <i class="fas fa-cog mr-2 text-indigo-500"></i>系统设置
                </h3>
            </div>

            <div class="px-6 py-4">
                <ul class="flex border-b border-gray-200">
                    <li class="mr-1">
                        <button id="generalTab" class="inline-block py-2 px-4 font-semibold text-indigo-600 border-b-2 border-indigo-600">基本设置</button>
                    </li>
                    <li class="mr-1">
                        <button id="profileTab" class="inline-block py-2 px-4 text-gray-600 hover:text-indigo-600">个人信息</button>
                    </li>
                    <li class="mr-1">
                        <button id="dataTab" class="inline-block py-2 px-4 text-gray-600 hover:text-indigo-600">数据管理</button>
                    </li>
                    <li class="mr-1">
                        <button id="syncTab" class="inline-block py-2 px-4 text-gray-600 hover:text-indigo-600">同步设置</button>
                    </li>
                </ul>

                <!-- 基本设置 -->
                <div id="generalSettings" class="py-4 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">主题颜色</label>
                        <div class="flex space-x-2">
                            <button data-color="indigo" class="w-8 h-8 rounded-full bg-indigo-600 border-2 border-indigo-800 focus:outline-none"></button>
                            <button data-color="blue" class="w-8 h-8 rounded-full bg-blue-600 border-2 border-transparent hover:border-blue-800 focus:outline-none"></button>
                            <button data-color="green" class="w-8 h-8 rounded-full bg-green-600 border-2 border-transparent hover:border-green-800 focus:outline-none"></button>
                            <button data-color="red" class="w-8 h-8 rounded-full bg-red-600 border-2 border-transparent hover:border-red-800 focus:outline-none"></button>
                            <button data-color="purple" class="w-8 h-8 rounded-full bg-purple-600 border-2 border-transparent hover:border-purple-800 focus:outline-none"></button>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">支出分类</label>
                        <div class="flex flex-wrap gap-2">
                            <input type="text" id="newExpenseCategory" placeholder="添加新分类" class="flex-1 min-w-0 px-3 py-2 text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            <button id="addExpenseCategory" class="px-3 py-2 bg-indigo-600 text-white text-sm rounded-md hover:bg-indigo-700">添加</button>
                        </div>
                        <div id="expenseCategoryTags" class="mt-2 flex flex-wrap gap-2">
                            <!-- 分类标签将通过JavaScript动态生成 -->
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">收入分类</label>
                        <div class="flex flex-wrap gap-2">
                            <input type="text" id="newIncomeCategory" placeholder="添加新分类" class="flex-1 min-w-0 px-3 py-2 text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            <button id="addIncomeCategory" class="px-3 py-2 bg-indigo-600 text-white text-sm rounded-md hover:bg-indigo-700">添加</button>
                        </div>
                        <div id="incomeCategoryTags" class="mt-2 flex flex-wrap gap-2">
                            <!-- 分类标签将通过JavaScript动态生成 -->
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">默认货币</label>
                        <select id="currency" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <option value="¥">人民币 (¥)</option>
                            <option value="$">美元 ($)</option>
                            <option value="€">欧元 (€)</option>
                            <option value="£">英镑 (£)</option>
                            <option value="¥">日元 (¥)</option>
                        </select>
                    </div>
                </div>

                <!-- 个人信息 -->
                <div id="profileSettings" class="py-4 space-y-4 hidden">
                    <div>
                        <label for="userName" class="block text-sm font-medium text-gray-700 mb-1">姓名</label>
                        <input type="text" id="userName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>

                    <div>
                        <label for="userEmail" class="block text-sm font-medium text-gray-700 mb-1">电子邮箱</label>
                        <input type="email" id="userEmail" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>

                    <div>
                        <label for="userBudget" class="block text-sm font-medium text-gray-700 mb-1">月度预算</label>
                        <div class="relative rounded-md shadow-sm">
                            <span id="currencySymbol" class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-500 sm:text-sm">¥</span>
                            </span>
                            <input type="number" id="userBudget" class="focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-7 pr-12 py-2 sm:text-sm border-gray-300 rounded-md" placeholder="0.00" step="0.01">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">预算提醒</label>
                        <div class="flex items-center">
                            <input type="checkbox" id="budgetAlert" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <label for="budgetAlert" class="ml-2 block text-sm text-gray-700">启用预算超支提醒</label>
                        </div>
                    </div>
                </div>

                <!-- 数据管理 -->
                <div id="dataSettings" class="py-4 space-y-4 hidden">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">数据备份</label>
                        <p class="text-sm text-gray-500 mb-2">定期备份您的记账数据以防止数据丢失</p>
                        <button id="backupNow" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                            <i class="fas fa-save mr-1"></i>立即备份
                        </button>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">数据恢复</label>
                        <div class="flex items-center space-x-2">
                            <input type="file" id="restoreFile" accept=".json" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                            <button id="restoreBtn" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                                <i class="fas fa-file-import mr-1"></i>恢复
                            </button>
                        </div>
                    </div>

                    <div class="pt-4 border-t border-gray-200">
                        <label class="block text-sm font-medium text-gray-700 mb-1">危险区域</label>
                        <p class="text-sm text-gray-500 mb-2">此操作将删除所有记账数据，无法恢复</p>
                        <button id="clearDataBtn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                            <i class="fas fa-trash-alt mr-1"></i>清空所有数据
                        </button>
                    </div>
                </div>

                <!-- 同步设置 -->
                <div id="syncSettings" class="py-4 space-y-4 hidden">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">同步方式</label>
                        <div class="space-y-4">
                            <div class="flex items-center">
                                <input id="syncNone" name="syncMethod" type="radio" checked class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                <label for="syncNone" class="ml-2 block text-sm text-gray-700">不同步</label>
                            </div>
                            <div class="flex items-center">
                                <input id="syncGithub" name="syncMethod" type="radio" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                <label for="syncGithub" class="ml-2 block text-sm text-gray-700">GitHub</label>
                            </div>
                            <div class="flex items-center">
                                <input id="syncJianGuoYun" name="syncMethod" type="radio" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                <label for="syncJianGuoYun" class="ml-2 block text-sm text-gray-700">坚果云</label>
                            </div>
                        </div>
                    </div>

                    <!-- GitHub 同步设置 -->
                    <div id="githubSettings" class="space-y-4 hidden">
                        <div>
                            <label for="githubToken" class="block text-sm font-medium text-gray-700 mb-1">GitHub Personal Access Token</label>
                            <input type="password" id="githubToken" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="输入您的GitHub Token">
                            <p class="mt-1 text-sm text-gray-500">需要repo权限的GitHub Personal Access Token</p>
                        </div>

                        <div>
                            <label for="githubRepo" class="block text-sm font-medium text-gray-700 mb-1">GitHub 仓库</label>
                            <input type="text" id="githubRepo" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="username/repo">
                        </div>

                        <div>
                            <label for="githubFilePath" class="block text-sm font-medium text-gray-700 mb-1">文件路径</label>
                            <input type="text" id="githubFilePath" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="data/accounting.json" value="data/accounting.json">
                        </div>

                        <div>
                            <label for="githubBranch" class="block text-sm font-medium text-gray-700 mb-1">分支</label>
                            <input type="text" id="githubBranch" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="main" value="main">
                        </div>
                    </div>

                    <!-- 坚果云同步设置 -->
                    <div id="jianGuoYunSettings" class="space-y-4 hidden">
                        <div>
                            <label for="jianGuoYunUsername" class="block text-sm font-medium text-gray-700 mb-1">坚果云用户名</label>
                            <input type="text" id="jianGuoYunUsername" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="输入您的坚果云用户名">
                        </div>

                        <div>
                            <label for="jianGuoYunPassword" class="block text-sm font-medium text-gray-700 mb-1">坚果云密码</label>
                            <input type="password" id="jianGuoYunPassword" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="输入您的坚果云密码">
                            <p class="mt-1 text-sm text-gray-500">坚果云需要应用密码，请在坚果云后台生成</p>
                        </div>

                        <div>
                            <label for="jianGuoYunFilePath" class="block text-sm font-medium text-gray-700 mb-1">文件路径</label>
                            <input type="text" id="jianGuoYunFilePath" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="/accounting.json" value="/accounting.json">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">自动同步</label>
                        <div class="flex items-center">
                            <input type="checkbox" id="autoSync" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <label for="autoSync" class="ml-2 block text-sm text-gray-700">每次修改后自动同步</label>
                        </div>
                    </div>

                    <div class="pt-2">
                        <button id="testSyncBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            <i class="fas fa-plug mr-1"></i>测试连接
                        </button>
                    </div>
                </div>
            </div>

            <div class="px-6 py-4 border-t border-gray-200 flex justify-end">
                <button id="closeSettings" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 mr-2">
                    取消
                </button>
                <button id="saveSettings" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                    保存设置
                </button>
            </div>
        </div>
    </div>

    <!-- 同步模态框 -->
    <div id="syncModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800">同步数据</h3>
            </div>
            <div class="px-6 py-4">
                <div class="flex items-center mb-4">
                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                        <i class="fas fa-sync-alt text-blue-500"></i>
                    </div>
                    <div>
                        <p class="font-medium">选择同步方向</p>
                        <p class="text-sm text-gray-500">请选择要同步的方向</p>
                    </div>
                </div>

                <div class="space-y-3">
                    <div class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 sync-option" data-direction="upload">
                        <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center mr-3">
                            <i class="fas fa-cloud-upload-alt text-indigo-500"></i>
                        </div>
                        <div>
                            <p class="font-medium">上传到云端</p>
                            <p class="text-sm text-gray-500">将本地数据上传到云端，覆盖云端数据</p>
                        </div>
                    </div>

                    <div class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 sync-option" data-direction="download">
                        <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mr-3">
                            <i class="fas fa-cloud-download-alt text-green-500"></i>
                        </div>
                        <div>
                            <p class="font-medium">从云端下载</p>
                            <p class="text-sm text-gray-500">将云端数据下载到本地，覆盖本地数据</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 flex justify-end">
                <button id="cancelSync" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 mr-2">
                    取消
                </button>
                <button id="confirmSync" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                    开始同步
                </button>
            </div>
        </div>
    </div>

    <!-- 同步进度模态框 -->
    <div id="syncProgressModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800">同步中...</h3>
            </div>
            <div class="px-6 py-4">
                <div class="flex items-center mb-4">
                    <div id="syncStatusIcon" class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                        <i class="fas fa-sync-alt fa-spin text-blue-500"></i>
                    </div>
                    <div>
                        <p id="syncStatusText" class="font-medium">正在同步数据</p>
                        <p id="syncStatusDetail" class="text-sm text-gray-500">请稍候...</p>
                    </div>
                </div>

                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="syncProgressBar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
                <p id="syncProgressText" class="mt-2 text-right text-sm text-gray-500">0%</p>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 flex justify-end">
                <button id="cancelSyncProgress" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 mr-2">
                    取消
                </button>
            </div>
        </div>
    </div>

    <!-- 删除确认模态框 -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800">确认删除</h3>
            </div>
            <div class="px-6 py-4">
                <p>确定要删除这条记录吗？此操作无法撤销。</p>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 flex justify-end">
                <button id="cancelDelete" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 mr-2">
                    取消
                </button>
                <button id="confirmDelete" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                    确认删除
                </button>
            </div>
        </div>
    </div>

    <!-- 通知提示 -->
    <div id="notification" class="fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-md shadow-lg hidden z-50">
        <div class="flex items-center">
            <i class="fas fa-check-circle mr-2"></i>
            <span id="notificationMessage">操作成功</span>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化数据
            if (!localStorage.getItem('expenses')) {
                localStorage.setItem('expenses', JSON.stringify([]));
            }

            if (!localStorage.getItem('settings')) {
                localStorage.setItem('settings', JSON.stringify({
                    expenseCategories: ['餐饮', '交通', '购物', '娱乐', '住房', '医疗', '教育', '其他'],
                    incomeCategories: ['工资', '奖金', '投资', '兼职', '其他'],
                    currency: '¥',
                    themeColor: 'indigo',
                    userProfile: {
                        name: '',
                        email: '',
                        budget: 0,
                        budgetAlert: false
                    },
                    syncSettings: {
                        method: 'none',
                        github: {
                            token: '',
                            repo: '',
                            filePath: 'data/accounting.json',
                            branch: 'main'
                        },
                        jianGuoYun: {
                            username: '',
                            password: '',
                            filePath: '/accounting.json'
                        },
                        autoSync: false
                    }
                }));
            }

            // 获取当前日期并设置为默认值
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;

            // 当前账单类型 (expense/income)
            let currentType = 'expense';

            // 加载设置
            loadSettings();

            // 加载账单数据
            loadExpenses();

            // 计算并显示统计信息
            calculateStatistics();

            // 类型切换
            document.getElementById('expenseType').addEventListener('click', function() {
                currentType = 'expense';
                this.classList.add('active');
                document.getElementById('incomeType').classList.remove('active');
                updateCategoryOptions();
            });

            document.getElementById('incomeType').addEventListener('click', function() {
                currentType = 'income';
                this.classList.add('active');
                document.getElementById('expenseType').classList.remove('active');
                updateCategoryOptions();
            });

            // 表单提交事件
            document.getElementById('expenseForm').addEventListener('submit', function(e) {
                e.preventDefault();

                const amount = parseFloat(document.getElementById('amount').value);
                const category = document.getElementById('category').value;
                const date = document.getElementById('date').value;
                const description = document.getElementById('description').value;

                if (isNaN(amount) || amount <= 0) {
                    showNotification('请输入有效的金额', 'red');
                    return;
                }

                const expenses = JSON.parse(localStorage.getItem('expenses'));
                expenses.push({
                    id: Date.now(),
                    type: currentType,
                    amount: amount,
                    category: category,
                    date: date,
                    description: description
                });

                localStorage.setItem('expenses', JSON.stringify(expenses));

                // 重新加载账单
                loadExpenses();

                // 计算统计信息
                calculateStatistics();

                // 重置表单
                this.reset();
                document.getElementById('date').value = today;
                document.getElementById('expenseType').click();

                showNotification('账单添加成功');

                // 自动同步
                const settings = JSON.parse(localStorage.getItem('settings'));
                if (settings.syncSettings.autoSync && settings.syncSettings.method !== 'none') {
                    syncData('upload');
                }
            });

            // 过滤事件
            document.getElementById('filterType').addEventListener('change', function() {
                loadExpenses();
            });

            document.getElementById('filterCategory').addEventListener('change', function() {
                loadExpenses();
            });

            document.getElementById('filterDate').addEventListener('change', function() {
                loadExpenses();
            });

            // 设置模态框
            const settingsModal = document.getElementById('settingsModal');
            const settingsBtn = document.getElementById('settingsBtn');
            const closeSettings = document.getElementById('closeSettings');
            const saveSettings = document.getElementById('saveSettings');

            settingsBtn.addEventListener('click', function() {
                settingsModal.classList.remove('hidden');
            });

            closeSettings.addEventListener('click', function() {
                settingsModal.classList.add('hidden');
            });

            saveSettings.addEventListener('click', function() {
                saveSettingsToLocalStorage();
                loadSettings();
                settingsModal.classList.add('hidden');
                showNotification('设置保存成功');
            });

            // 标签切换
            const generalTab = document.getElementById('generalTab');
            const profileTab = document.getElementById('profileTab');
            const dataTab = document.getElementById('dataTab');
            const syncTab = document.getElementById('syncTab');

            const generalSettings = document.getElementById('generalSettings');
            const profileSettings = document.getElementById('profileSettings');
            const dataSettings = document.getElementById('dataSettings');
            const syncSettings = document.getElementById('syncSettings');

            generalTab.addEventListener('click', function() {
                generalSettings.classList.remove('hidden');
                profileSettings.classList.add('hidden');
                dataSettings.classList.add('hidden');
                syncSettings.classList.add('hidden');

                generalTab.classList.add('text-indigo-600', 'border-indigo-600');
                profileTab.classList.remove('text-indigo-600', 'border-indigo-600');
                dataTab.classList.remove('text-indigo-600', 'border-indigo-600');
                syncTab.classList.remove('text-indigo-600', 'border-indigo-600');
            });

            profileTab.addEventListener('click', function() {
                generalSettings.classList.add('hidden');
                profileSettings.classList.remove('hidden');
                dataSettings.classList.add('hidden');
                syncSettings.classList.add('hidden');

                generalTab.classList.remove('text-indigo-600', 'border-indigo-600');
                profileTab.classList.add('text-indigo-600', 'border-indigo-600');
                dataTab.classList.remove('text-indigo-600', 'border-indigo-600');
                syncTab.classList.remove('text-indigo-600', 'border-indigo-600');
            });

            dataTab.addEventListener('click', function() {
                generalSettings.classList.add('hidden');
                profileSettings.classList.add('hidden');
                dataSettings.classList.remove('hidden');
                syncSettings.classList.add('hidden');

                generalTab.classList.remove('text-indigo-600', 'border-indigo-600');
                profileTab.classList.remove('text-indigo-600', 'border-indigo-600');
                dataTab.classList.add('text-indigo-600', 'border-indigo-600');
                syncTab.classList.remove('text-indigo-600', 'border-indigo-600');
            });

            syncTab.addEventListener('click', function() {
                generalSettings.classList.add('hidden');
                profileSettings.classList.add('hidden');
                dataSettings.classList.add('hidden');
                syncSettings.classList.remove('hidden');

                generalTab.classList.remove('text-indigo-600', 'border-indigo-600');
                profileTab.classList.remove('text-indigo-600', 'border-indigo-600');
                dataTab.classList.remove('text-indigo-600', 'border-indigo-600');
                syncTab.classList.add('text-indigo-600', 'border-indigo-600');
            });

            // 同步方式切换
            document.querySelectorAll('input[name="syncMethod"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    document.getElementById('githubSettings').classList.add('hidden');
                    document.getElementById('jianGuoYunSettings').classList.add('hidden');

                    if (this.id === 'syncGithub') {
                        document.getElementById('githubSettings').classList.remove('hidden');
                    } else if (this.id === 'syncJianGuoYun') {
                        document.getElementById('jianGuoYunSettings').classList.remove('hidden');
                    }
                });
            });

            // 主题颜色选择
            document.querySelectorAll('[data-color]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('[data-color]').forEach(b => {
                        b.classList.remove('border-indigo-800', 'border-blue-800', 'border-green-800', 'border-red-800', 'border-purple-800');
                        b.classList.add('border-transparent', 'hover:border-' + b.dataset.color + '-800');
                    });

                    this.classList.remove('border-transparent', 'hover:border-' + this.dataset.color + '-800');
                    this.classList.add('border-' + this.dataset.color + '-800');
                });
            });

            // 添加支出分类
            document.getElementById('addExpenseCategory').addEventListener('click', function() {
                const newCategory = document.getElementById('newExpenseCategory').value.trim();
                if (!newCategory) return;

                const settings = JSON.parse(localStorage.getItem('settings'));
                if (!settings.expenseCategories.includes(newCategory)) {
                    settings.expenseCategories.push(newCategory);
                    localStorage.setItem('settings', JSON.stringify(settings));

                    // 更新分类选择
                    updateCategoryOptions();

                    // 显示通知
                    showNotification('支出分类添加成功');

                    // 清空输入框
                    document.getElementById('newExpenseCategory').value = '';
                } else {
                    showNotification('分类已存在', 'yellow');
                }
            });

            // 添加收入分类
            document.getElementById('addIncomeCategory').addEventListener('click', function() {
                const newCategory = document.getElementById('newIncomeCategory').value.trim();
                if (!newCategory) return;

                const settings = JSON.parse(localStorage.getItem('settings'));
                if (!settings.incomeCategories.includes(newCategory)) {
                    settings.incomeCategories.push(newCategory);
                    localStorage.setItem('settings', JSON.stringify(settings));

                    // 更新分类选择
                    updateCategoryOptions();

                    // 显示通知
                    showNotification('收入分类添加成功');

                    // 清空输入框
                    document.getElementById('newIncomeCategory').value = '';
                } else {
                    showNotification('分类已存在', 'yellow');
                }
            });

            // 删除支出分类
            document.getElementById('expenseCategoryTags').addEventListener('click', function(e) {
                if (e.target.classList.contains('delete-category')) {
                    const category = e.target.dataset.category;
                    const settings = JSON.parse(localStorage.getItem('settings'));

                    // 从设置中删除分类
                    settings.expenseCategories = settings.expenseCategories.filter(c => c !== category);
                    localStorage.setItem('settings', JSON.stringify(settings));

                    // 更新分类选择
                    updateCategoryOptions();

                    // 显示通知
                    showNotification('支出分类删除成功');
                }
            });

            // 删除收入分类
            document.getElementById('incomeCategoryTags').addEventListener('click', function(e) {
                if (e.target.classList.contains('delete-category')) {
                    const category = e.target.dataset.category;
                    const settings = JSON.parse(localStorage.getItem('settings'));

                    // 从设置中删除分类
                    settings.incomeCategories = settings.incomeCategories.filter(c => c !== category);
                    localStorage.setItem('settings', JSON.stringify(settings));

                    // 更新分类选择
                    updateCategoryOptions();

                    // 显示通知
                    showNotification('收入分类删除成功');
                }
            });

            // 数据备份
            document.getElementById('backupNow').addEventListener('click', function() {
                exportData();
            });

            // 数据恢复
            document.getElementById('restoreBtn').addEventListener('click', function() {
                const fileInput = document.getElementById('restoreFile');
                if (fileInput.files.length === 0) {
                    showNotification('请选择要恢复的文件', 'red');
                    return;
                }

                const file = fileInput.files[0];
                const reader = new FileReader();

                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);

                        if (data.expenses && data.settings) {
                            localStorage.setItem('expenses', JSON.stringify(data.expenses));
                            localStorage.setItem('settings', JSON.stringify(data.settings));

                            // 重新加载数据
                            loadExpenses();
                            loadSettings();

                            showNotification('数据恢复成功');
                        } else {
                            showNotification('文件格式不正确', 'red');
                        }
                    } catch (error) {
                        showNotification('文件解析失败: ' + error.message, 'red');
                    }
                };

                reader.readAsText(file);
            });

            // 清空数据
            const confirmModal = document.getElementById('confirmModal');
            const clearDataBtn = document.getElementById('clearDataBtn');
            const cancelDelete = document.getElementById('cancelDelete');
            const confirmDelete = document.getElementById('confirmDelete');

            clearDataBtn.addEventListener('click', function() {
                confirmModal.classList.remove('hidden');
            });

            cancelDelete.addEventListener('click', function() {
                confirmModal.classList.add('hidden');
            });

            confirmDelete.addEventListener('click', function() {
                localStorage.setItem('expenses', JSON.stringify([]));
                loadExpenses();
                calculateStatistics();
                confirmModal.classList.add('hidden');
                showNotification('所有数据已清空');
            });

            // 导出数据
            document.getElementById('exportBtn').addEventListener('click', function() {
                exportData();
            });

            // 同步数据
            const syncModal = document.getElementById('syncModal');
            const syncBtn = document.getElementById('syncBtn');
            const cancelSync = document.getElementById('cancelSync');
            const confirmSync = document.getElementById('confirmSync');
            const syncOptions = document.querySelectorAll('.sync-option');
            const syncProgressModal = document.getElementById('syncProgressModal');
            const cancelSyncProgress = document.getElementById('cancelSyncProgress');
            const testSyncBtn = document.getElementById('testSyncBtn');

            let syncDirection = 'upload';

            syncBtn.addEventListener('click', function() {
                syncModal.classList.remove('hidden');
            });

            cancelSync.addEventListener('click', function() {
                syncModal.classList.add('hidden');
            });

            syncOptions.forEach(option => {
                option.addEventListener('click', function() {
                    syncOptions.forEach(opt => opt.classList.remove('bg-blue-50', 'border-blue-300'));
                    this.classList.add('bg-blue-50', 'border-blue-300');
                    syncDirection = this.dataset.direction;
                });
            });

            confirmSync.addEventListener('click', function() {
                syncModal.classList.add('hidden');
                syncData(syncDirection);
            });

            cancelSyncProgress.addEventListener('click', function() {
                syncProgressModal.classList.add('hidden');
                // 这里可以添加取消同步的逻辑
            });

                        testSyncBtn.addEventListener('click', function() {
                const settings = JSON.parse(localStorage.getItem('settings'));

                if (settings.syncSettings.method === 'none') {
                    showNotification('请先选择同步方式并保存设置', 'yellow');
                    return;
                }

                syncProgressModal.classList.remove('hidden');
                document.getElementById('syncStatusText').textContent = '正在测试连接...';
                document.getElementById('syncStatusDetail').textContent = '请稍候...';
                document.getElementById('syncProgressBar').style.width = '0%';
                document.getElementById('syncProgressText').textContent = '0%';

                // 模拟测试连接
                setTimeout(() => {
                    document.getElementById('syncProgressBar').style.width = '100%';
                    document.getElementById('syncProgressText').textContent = '100%';

                    const icon = document.getElementById('syncStatusIcon');
                    icon.className = 'w-8 h-8 rounded-full bg-green-100 flex items-center justify-center mr-3';
                    icon.innerHTML = '<i class="fas fa-check text-green-500"></i>';

                    document.getElementById('syncStatusText').textContent = '连接测试成功';
                    document.getElementById('syncStatusDetail').textContent = '云端连接正常';

                    setTimeout(() => {
                        syncProgressModal.classList.add('hidden');
                        showNotification('连接测试成功');
                    }, 1000);
                }, 1500);
            });

            // 加载设置函数
            function loadSettings() {
                const settings = JSON.parse(localStorage.getItem('settings'));

                // 更新分类选择
                updateCategoryOptions();

                // 设置主题颜色
                const themeBtn = document.querySelector(`[data-color="${settings.themeColor}"]`);
                if (themeBtn) themeBtn.click();

                // 设置货币
                document.getElementById('currency').value = settings.currency;
                document.getElementById('currencySymbol').textContent = settings.currency;

                // 设置个人信息
                document.getElementById('userName').value = settings.userProfile.name || '';
                document.getElementById('userEmail').value = settings.userProfile.email || '';
                document.getElementById('userBudget').value = settings.userProfile.budget || 0;
                document.getElementById('budgetAlert').checked = settings.userProfile.budgetAlert || false;

                // 设置同步选项
                document.getElementById('syncNone').checked = settings.syncSettings.method === 'none';
                document.getElementById('syncGithub').checked = settings.syncSettings.method === 'github';
                document.getElementById('syncJianGuoYun').checked = settings.syncSettings.method === 'jianGuoYun';

                // 设置GitHub选项
                document.getElementById('githubToken').value = settings.syncSettings.github.token || '';
                document.getElementById('githubRepo').value = settings.syncSettings.github.repo || '';
                document.getElementById('githubFilePath').value = settings.syncSettings.github.filePath || 'data/accounting.json';
                document.getElementById('githubBranch').value = settings.syncSettings.github.branch || 'main';

                // 设置坚果云选项
                document.getElementById('jianGuoYunUsername').value = settings.syncSettings.jianGuoYun.username || '';
                document.getElementById('jianGuoYunPassword').value = settings.syncSettings.jianGuoYun.password || '';
                document.getElementById('jianGuoYunFilePath').value = settings.syncSettings.jianGuoYun.filePath || '/accounting.json';

                // 设置自动同步
                document.getElementById('autoSync').checked = settings.syncSettings.autoSync || false;

                // 显示/隐藏对应的同步设置
                document.getElementById('githubSettings').classList.add('hidden');
                document.getElementById('jianGuoYunSettings').classList.add('hidden');

                if (settings.syncSettings.method === 'github') {
                    document.getElementById('githubSettings').classList.remove('hidden');
                } else if (settings.syncSettings.method === 'jianGuoYun') {
                    document.getElementById('jianGuoYunSettings').classList.remove('hidden');
                }
            }

            // 保存设置函数
            function saveSettingsToLocalStorage() {
                const settings = JSON.parse(localStorage.getItem('settings'));

                // 获取主题颜色
                const themeBtn = document.querySelector('[data-color].border-indigo-800, [data-color].border-blue-800, [data-color].border-green-800, [data-color].border-red-800, [data-color].border-purple-800');
                settings.themeColor = themeBtn ? themeBtn.dataset.color : 'indigo';

                // 获取货币设置
                settings.currency = document.getElementById('currency').value;

                // 保存个人信息
                settings.userProfile = {
                    name: document.getElementById('userName').value,
                    email: document.getElementById('userEmail').value,
                    budget: parseFloat(document.getElementById('userBudget').value) || 0,
                    budgetAlert: document.getElementById('budgetAlert').checked
                };

                // 保存同步设置
                settings.syncSettings = {
                    method: document.querySelector('input[name="syncMethod"]:checked').value,
                    github: {
                        token: document.getElementById('githubToken').value,
                        repo: document.getElementById('githubRepo').value,
                        filePath: document.getElementById('githubFilePath').value,
                        branch: document.getElementById('githubBranch').value
                    },
                    jianGuoYun: {
                        username: document.getElementById('jianGuoYunUsername').value,
                        password: document.getElementById('jianGuoYunPassword').value,
                        filePath: document.getElementById('jianGuoYunFilePath').value
                    },
                    autoSync: document.getElementById('autoSync').checked
                };

                localStorage.setItem('settings', JSON.stringify(settings));
            }

            // 更新分类选择
            function updateCategoryOptions() {
                const settings = JSON.parse(localStorage.getItem('settings'));
                const categorySelect = document.getElementById('category');
                const filterCategorySelect = document.getElementById('filterCategory');

                // 清空现有选项
                categorySelect.innerHTML = '';
                filterCategorySelect.innerHTML = '<option value="">所有分类</option>';

                // 根据当前类型添加分类
                if (currentType === 'expense') {
                    settings.expenseCategories.forEach(cat => {
                        const option = document.createElement('option');
                        option.value = cat;
                        option.textContent = cat;
                        categorySelect.appendChild(option);

                        const filterOption = document.createElement('option');
                        filterOption.value = cat;
                        filterOption.textContent = cat;
                        filterCategorySelect.appendChild(filterOption);
                    });
                } else {
                    settings.incomeCategories.forEach(cat => {
                        const option = document.createElement('option');
                        option.value = cat;
                        option.textContent = cat;
                        categorySelect.appendChild(option);

                        const filterOption = document.createElement('option');
                        filterOption.value = cat;
                        filterOption.textContent = cat;
                        filterCategorySelect.appendChild(filterOption);
                    });
                }

                // 更新支出分类标签显示
                const expenseCategoryTags = document.getElementById('expenseCategoryTags');
                expenseCategoryTags.innerHTML = '';

                settings.expenseCategories.forEach(cat => {
                    if (!['餐饮', '交通', '购物', '娱乐', '住房', '医疗', '教育', '其他'].includes(cat)) {
                        const tag = document.createElement('div');
                        tag.className = 'inline-flex items-center bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-sm';
                        tag.innerHTML = `
                            ${cat}
                            <button data-category="${cat}" class="delete-category ml-1 text-gray-500 hover:text-red-500">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                        expenseCategoryTags.appendChild(tag);
                    }
                });

                // 更新收入分类标签显示
                const incomeCategoryTags = document.getElementById('incomeCategoryTags');
                incomeCategoryTags.innerHTML = '';

                settings.incomeCategories.forEach(cat => {
                    if (!['工资', '奖金', '投资', '兼职', '其他'].includes(cat)) {
                        const tag = document.createElement('div');
                        tag.className = 'inline-flex items-center bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-sm';
                        tag.innerHTML = `
                            ${cat}
                            <button data-category="${cat}" class="delete-category ml-1 text-gray-500 hover:text-red-500">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                        incomeCategoryTags.appendChild(tag);
                    }
                });
            }

            // 加载账单函数
            function loadExpenses() {
                const expenses = JSON.parse(localStorage.getItem('expenses'));
                const expenseList = document.getElementById('expenseList');
                const filterType = document.getElementById('filterType').value;
                const filterCategory = document.getElementById('filterCategory').value;
                const filterDate = document.getElementById('filterDate').value;

                // 清空列表
                expenseList.innerHTML = '';

                // 过滤数据
                let filteredExpenses = [...expenses];

                if (filterType !== 'all') {
                    filteredExpenses = filteredExpenses.filter(exp => exp.type === filterType);
                }

                if (filterCategory) {
                    filteredExpenses = filteredExpenses.filter(exp => exp.category === filterCategory);
                }

                if (filterDate) {
                    filteredExpenses = filteredExpenses.filter(exp => exp.date === filterDate);
                }

                // 按日期排序（最新的在前面）
                filteredExpenses.sort((a, b) => new Date(b.date) - new Date(a.date));

                // 显示数据
                if (filteredExpenses.length === 0) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">暂无账单记录</td>
                    `;
                    expenseList.appendChild(tr);
                } else {
                    filteredExpenses.forEach(expense => {
                        const tr = document.createElement('tr');
                        tr.className = 'hover:bg-gray-50';
                        tr.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${expense.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                                ${expense.type === 'income' ? '收入' : '支出'}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(expense.date)}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${expense.category}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold ${expense.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                                ${expense.type === 'income' ? '+' : '-'}¥${expense.amount.toFixed(2)}
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">${expense.description || '无'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                <button data-id="${expense.id}" class="delete-btn text-red-600 hover:text-red-900 mr-2">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                                <button data-id="${expense.id}" class="edit-btn text-indigo-600 hover:text-indigo-900">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </td>
                        `;
                        expenseList.appendChild(tr);
                    });
                }

                // 更新总数
                document.getElementById('totalCount').textContent = filteredExpenses.length;

                // 计算总支出和总收入
                const totalExpense = filteredExpenses
                    .filter(exp => exp.type === 'expense')
                    .reduce((sum, exp) => sum + exp.amount, 0);

                const totalIncome = filteredExpenses
                    .filter(exp => exp.type === 'income')
                    .reduce((sum, exp) => sum + exp.amount, 0);

                document.getElementById('totalExpense').textContent = totalExpense.toFixed(2);
                document.getElementById('totalIncome').textContent = totalIncome.toFixed(2);
                document.getElementById('totalBalance').textContent = (totalIncome - totalExpense).toFixed(2);

                // 添加删除事件
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.dataset.id);
                        confirmModal.classList.remove('hidden');

                        confirmDelete.onclick = function() {
                            const expenses = JSON.parse(localStorage.getItem('expenses'));
                            const updatedExpenses = expenses.filter(exp => exp.id !== id);
                            localStorage.setItem('expenses', JSON.stringify(updatedExpenses));

                            loadExpenses();
                            calculateStatistics();
                            confirmModal.classList.add('hidden');
                            showNotification('账单删除成功');

                            // 自动同步
                            const settings = JSON.parse(localStorage.getItem('settings'));
                            if (settings.syncSettings.autoSync && settings.syncSettings.method !== 'none') {
                                syncData('upload');
                            }
                        };
                    });
                });

                // 添加编辑事件
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.dataset.id);
                        const expenses = JSON.parse(localStorage.getItem('expenses'));
                        const expense = expenses.find(exp => exp.id === id);

                        if (expense) {
                            // 设置类型
                            if (expense.type === 'income') {
                                document.getElementById('incomeType').click();
                            } else {
                                document.getElementById('expenseType').click();
                            }

                            document.getElementById('amount').value = expense.amount;
                            document.getElementById('category').value = expense.category;
                            document.getElementById('date').value = expense.date;
                            document.getElementById('description').value = expense.description || '';

                            // 滚动到表单
                            document.getElementById('expenseForm').scrollIntoView({
                                behavior: 'smooth'
                            });

                            // 从数组中删除该记录
                            const updatedExpenses = expenses.filter(exp => exp.id !== id);
                            localStorage.setItem('expenses', JSON.stringify(updatedExpenses));

                            showNotification('可以编辑选中的账单');
                        }
                    });
                });
            }

            // 计算统计信息
            function calculateStatistics() {
                const expenses = JSON.parse(localStorage.getItem('expenses'));
                const today = new Date().toISOString().split('T')[0];
                const currentDate = new Date();

                // 今日支出和收入
                const todayExpense = expenses
                    .filter(exp => exp.date === today && exp.type === 'expense')
                    .reduce((sum, exp) => sum + exp.amount, 0);

                const todayIncome = expenses
                    .filter(exp => exp.date === today && exp.type === 'income')
                    .reduce((sum, exp) => sum + exp.amount, 0);

                document.getElementById('todayExpense').textContent = todayExpense.toFixed(2);

                // 本周支出和收入
                const firstDayOfWeek = new Date(currentDate.setDate(currentDate.getDate() - currentDate.getDay()));
                const lastDayOfWeek = new Date(firstDayOfWeek);
                lastDayOfWeek.setDate(lastDayOfWeek.getDate() + 6);

                const weekExpense = expenses
                    .filter(exp => {
                        const expDate = new Date(exp.date);
                        return expDate >= firstDayOfWeek && expDate <= lastDayOfWeek && exp.type === 'expense';
                    })
                    .reduce((sum, exp) => sum + exp.amount, 0);

                const weekIncome = expenses
                    .filter(exp => {
                        const expDate = new Date(exp.date);
                        return expDate >= firstDayOfWeek && expDate <= lastDayOfWeek && exp.type === 'income';
                    })
                    .reduce((sum, exp) => sum + exp.amount, 0);

                document.getElementById('weekExpense').textContent = weekExpense.toFixed(2);

                // 本月支出和收入
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();

                const monthExpense = expenses
                    .filter(exp => {
                        const expDate = new Date(exp.date);
                        return expDate.getMonth() === currentMonth &&
                            expDate.getFullYear() === currentYear &&
                            exp.type === 'expense';
                    })
                    .reduce((sum, exp) => sum + exp.amount, 0);

                const monthIncome = expenses
                    .filter(exp => {
                        const expDate = new Date(exp.date);
                        return expDate.getMonth() === currentMonth &&
                            expDate.getFullYear() === currentYear &&
                            exp.type === 'income';
                    })
                    .reduce((sum, exp) => sum + exp.amount, 0);

                document.getElementById('monthExpense').textContent = monthExpense.toFixed(2);
                document.getElementById('monthBalance').textContent = (monthIncome - monthExpense).toFixed(2);

                // 预算提醒
                const settings = JSON.parse(localStorage.getItem('settings'));
                if (settings.userProfile.budgetAlert && settings.userProfile.budget > 0) {
                    const budgetPercentage = (monthExpense / settings.userProfile.budget) * 100;

                    if (budgetPercentage >= 100) {
                        showNotification('您的月度预算已超支!', 'red');
                    } else if (budgetPercentage >= 80) {
                        showNotification('您的月度预算已使用超过80%', 'yellow');
                    }
                }
            }

            // 导出数据
            function exportData() {
                const expenses = JSON.parse(localStorage.getItem('expenses'));
                const settings = JSON.parse(localStorage.getItem('settings'));

                const data = {
                    expenses: expenses,
                    settings: settings,
                    exportedAt: new Date().toISOString()
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], {
                    type: 'application/json'
                });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = `个人记账数据_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showNotification('数据导出成功');
            }

            // 同步数据
            function syncData(direction) {
                const settings = JSON.parse(localStorage.getItem('settings'));

                syncProgressModal.classList.remove('hidden');
                document.getElementById('syncStatusText').textContent = '正在同步数据...';
                document.getElementById('syncStatusDetail').textContent = '请稍候...';
                document.getElementById('syncProgressBar').style.width = '0%';
                document.getElementById('syncProgressText').textContent = '0%';

                // 模拟同步进度
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 10;
                    if (progress > 100) progress = 100;

                    document.getElementById('syncProgressBar').style.width = `${progress}%`;
                    document.getElementById('syncProgressText').textContent = `${progress}%`;

                    if (progress === 100) {
                        clearInterval(interval);

                        const icon = document.getElementById('syncStatusIcon');
                        icon.className = 'w-8 h-8 rounded-full bg-green-100 flex items-center justify-center mr-3';
                        icon.innerHTML = '<i class="fas fa-check text-green-500"></i>';

                        document.getElementById('syncStatusText').textContent = '同步完成';
                        document.getElementById('syncStatusDetail').textContent = '数据同步成功';

                        setTimeout(() => {
                            syncProgressModal.classList.add('hidden');
                            showNotification('数据同步成功');
                        }, 1000);
                    }
                }, 300);

                // 实际应用中，这里应该调用相应的API进行数据同步
                // 以下是模拟实现，实际应用中需要替换为真实的API调用

                if (settings.syncSettings.method === 'github') {
                    // GitHub同步逻辑
                    if (direction === 'upload') {
                        // 上传数据到GitHub
                        console.log('上传数据到GitHub');
                    } else {
                        // 从GitHub下载数据
                        console.log('从GitHub下载数据');
                    }
                } else if (settings.syncSettings.method === 'jianGuoYun') {
                    // 坚果云同步逻辑
                    if (direction === 'upload') {
                        // 上传数据到坚果云
                        console.log('上传数据到坚果云');
                    } else {
                        // 从坚果云下载数据
                        console.log('从坚果云下载数据');
                    }
                }
            }

            // 显示通知
            function showNotification(message, type = 'green') {
                const notification = document.getElementById('notification');
                const notificationMessage = document.getElementById('notificationMessage');

                notificationMessage.textContent = message;

                // 设置通知颜色
                notification.className = `fixed bottom-4 right-4 text-white px-4 py-2 rounded-md shadow-lg flex items-center z-50`;

                if (type === 'green') {
                    notification.classList.add('bg-green-500');
                } else if (type === 'red') {
                    notification.classList.add('bg-red-500');
                } else if (type === 'yellow') {
                    notification.classList.add('bg-yellow-500');
                } else {
                    notification.classList.add('bg-indigo-500');
                }

                // 显示通知
                notification.classList.remove('hidden');

                // 3秒后自动隐藏
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 3000);
            }

            // 格式化日期
            function formatDate(dateString) {
                const date = new Date(dateString);
                return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
            }
        });
    </script>
</body>
</html>